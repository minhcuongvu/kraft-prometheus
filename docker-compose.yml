services:
  kafka-controller-1:
    build:
      context: ./kafka
    container_name: kafka-controller-1
    hostname: kafka-controller-1
    restart: always
    environment:
      - NODE_ID=1
      - PORT=7071
      - KAFKA_PROCESS_ROLES=controller
      - KAFKA_LISTENERS=CONTROLLER://kafka-controller-1:9092
      - KAFKA_QUORUM_VOTERS=1@kafka-controller-1:9092
      - KAFKA_LOG_DIRS=/opt/kafka/data
    ports:
      - "7071:7071"
    volumes:
      - kafka-data-1:/opt/kafka/data
    networks:
      - kafka-network
  kafka-broker-1:
    build:
      context: ./kafka
    container_name: kafka-broker-1
    hostname: kafka-broker-1
    restart: always
    environment:
      - NODE_ID=2
      - PORT=7072
      - KAFKA_PROCESS_ROLES=broker
      - KAFKA_LISTENERS=PLAINTEXT://kafka-broker-1:9092
      - KAFKA_ADVERTISED_LISTENERS=advertised.listeners=PLAINTEXT://kafka-broker-1:9092
      - KAFKA_QUORUM_VOTERS=1@kafka-controller-1:9092
      - KAFKA_LOG_DIRS=/opt/kafka/data
    ports:
      - "7072:7072"
    volumes:
      - kafka-data-2:/opt/kafka/data
    networks:
      - kafka-network
  kafka-broker-2:
    build:
      context: ./kafka
    container_name: kafka-broker-2
    hostname: kafka-broker-2
    restart: always
    environment:
      - NODE_ID=3
      - PORT=7073
      - KAFKA_PROCESS_ROLES=broker
      - KAFKA_LISTENERS=PLAINTEXT://kafka-broker-2:9092
      - KAFKA_ADVERTISED_LISTENERS=advertised.listeners=PLAINTEXT://kafka-broker-2:9092
      - KAFKA_QUORUM_VOTERS=1@kafka-controller-1:9092
      - KAFKA_LOG_DIRS=/opt/kafka/data
    ports:
      - "7073:7073"
    volumes:
      - kafka-data-3:/opt/kafka/data
    networks:
      - kafka-network

  prometheus:
    build:
      context: ./prometheus
    container_name: prometheus
    hostname: prometheus
    restart: always
    ports:
    - "9090:9090"
    networks:
    - kafka-network

networks:
  kafka-network:
    driver: bridge

volumes:
  kafka-data-1:
  kafka-data-2:
  kafka-data-3:
